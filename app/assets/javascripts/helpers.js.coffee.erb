String::sprintf  = (args...) -> vsprintf(this, args)
String::vsprintf = (args)    -> vsprintf(this, args)

Math.log2 = (num) -> Math.log(num) / Math.LN2


String::underscore = ->
  this.
  replace(/\W+/g, "_").
  replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2').
  replace(/([a-z\d])([A-Z])/g,     '$1_$2').
  replace(/_+/g, "_").
  toLowerCase()

String::to_i = ->
  parseInt(this)

#

_.present = (obj) ->
  return false if not obj                  # falsy  is not present
  return (obj.length > 0) if _.isArray(obj) or _.isString(obj) # not present if length 0
  return true if  $.type(obj) != 'object'  # dates, numbers, regexps etc are present
  return (obj.length > 0) if obj.length?   # not present if object with obj.length 0
  return true for own key of obj           # an object with keys is present
  false                                    # otherwise, not present

# _.present_orig = _.present
# _.present = (obj) ->
#   res = _.present_orig(obj)
#   window.fiddle = obj
#   console.log( {
#     _me: obj, _res: res, bool: (not obj), type: $.type(obj),
#     len_0_a:    (obj.length is 0 if obj and obj.hasOwnProperty('length')),
#     is_obj:     ($.type(obj) == 'object'),
#     obj_w_len:  (($.type(obj) == 'object') and ('length' in obj)),
#     obj_w_len2: ('selector' in obj),
#     a: obj['selector'],
#     b: obj['length'],
#     len: obj.length,
#     len_0_b:    (obj.length is 0 if (($.type(obj) == 'object') and ('length' in obj))),
#     obj_own_prop: (prop for own prop of obj)
#     obj_all_prop: (prop for prop of obj)
#     }) if obj
#   res

_.blank = (val) -> not _.present(val)

#
# Return the first non-emp
_.first_nonblank = (args...) ->
  result = null
  _.each args, (fn, index, list) ->
    val = if _.isFunction(fn) then do(fn) else fn
    if _.present(val) then (result = val ; _.breakLoop())
  result

<%# - require_dependency('app/models/tournament') ; 1 %>

window.MATCH_FOR_SEED = <%= Tournament::MATCH_FOR_SEED.to_json %>
window.SEED_FOR_SLOT  = <%= Tournament::SEED_FOR_SLOT.to_json %>
window.SLOT_FOR_SEED  = <%= Tournament::SLOT_FOR_SEED.to_json %>

# window.MATCH_FOR_SEED = {}
# window.SEED_FOR_SLOT  = {}
# window.SLOT_FOR_SEED  = {}
# SEED_FOR_SLOT_ARR = <%= JSON.generate(Tournament::SEED_FOR_SLOT_ARR) %>
# for t_size, seed_for_slot of SEED_FOR_SLOT_ARR
#   MATCH_FOR_SEED[t_size] = [] ; SLOT_FOR_SEED[t_size] = []; SEED_FOR_SLOT[t_size] = []
#   for seed, slot in seed_for_slot
#     continue if seed is 0
#     SEED_FOR_SLOT[ t_size][slot] = seed
#     SLOT_FOR_SEED[ t_size][seed] = slot
#     MATCH_FOR_SEED[t_size][seed] = Math.ceil(slot / 2)
# console.log( MATCH_FOR_SEED, <%= Tournament::MATCH_FOR_SEED.to_json %>)
# console.log( SLOT_FOR_SEED,  <%= Tournament::SLOT_FOR_SEED.to_json %>)
# console.log( SEED_FOR_SLOT,  <%= Tournament::SEED_FOR_SLOT.to_json %>)
